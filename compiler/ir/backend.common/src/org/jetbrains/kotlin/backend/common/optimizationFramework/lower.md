# Optimizations

## TOC

- [Optimizations](#optimizations)
  - [TOC](#toc)
  - [AnnotationLowering](#annotationlowering)
  - [AssertionLowering](#assertionlowering)
  - [ConstLowering](#constlowering)
  - [CheckNotNullLowering](#checknotnulllowering)
  - [JvmStandardLibraryBuiltInsLowering](#jvmstandardlibrarybuiltinslowering)
  - [StringTrimLowering](#stringtrimlowering)
  - [RangeContainsLowering](#rangecontainslowering)
  - [KotlinNothingValueExceptionLowering](#kotlinnothingvalueexceptionlowering)

## AnnotationLowering

Remove constructors of annotation classes

```Kotlin
anootation class A() {
    constructor() {

    }
}
```

=>

```Kotlin
anootation class A {
}
```

## AssertionLowering

Lower assert calls depending on the assertions mode

Pre: `context.state.assertionsMode != JVMAssertionsMode.LEGACY`



## ConstLowering

Substitute calls to const properties with constant values

```kotlin
class A {
    val constVal = 2
    val a = this.getConstVal()
}
```

=>

```kotlin
class A {
    val constVal = 2
    val a = 2
}
```
Возможно я не совсем правильно понял понятие constValue. Но получается что-то такое.

## CheckNotNullLowering

Lower calls to the CHECK_NOT_NULL intrinsic, which are generated by psi2ir for "!!" expressions.

!!Посмотреть как на самом деле выглядит intrinsic для check not null.

```kotlin
CHECK_NOT_NULL(a)
```

=> `if unifiedNullChecks`

```kotlin
{
    checkNotNull(a)
    a as Type
}
```

=> `else`

```kotlin
{
    if(a == null)
        throwNpe()
    a as Type
}
```

## JvmStandardLibraryBuiltInsLowering

Use Java Standard Library implementations of built-ins

```kotlin
kotlin.UInt.compareTo(...)
```

=>

```kotlin
compareUnsigned(...)
```

## StringTrimLowering

Compute trimIndent and trimMargin operations on constant strings

Этот ловер использует матчеры, что очень близко с темой ФО.

```kotlin
"""    string """".trimIndent()
```

=>

```kotlin
"""string"""
```

## RangeContainsLowering

Optimizes calls to contains() for ClosedRanges.

```kotlin
X in A..B
```

=>

```kotlin
A <= X && X <= B
```

## KotlinNothingValueExceptionLowering

Throw proper exception for calls returning value of type `kotlin.Nothing`

```kotlin
[ call 'foo' with type: 'kotlin.Unit' ]
```

=>

```kotlin
{
    [ call 'foo' with type: 'kotlin.Unit' ]
    call ThrowKotlinNothingValueException(): Nothing
}: Nothing
```