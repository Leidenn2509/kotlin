# DSL for Optimization framework
Цель: описать DSL для фреймворка оптимизаций
Что должен уметь ФО:
- Описать и найти кусок кода на котором можно применить оптимизацию(трансформацию)
- Описать новый код для вставки/замены
- Описать куда или вместо чего будет вставлен новый код

## Мысли
1. Можно было бы описывать новый код прямо после кода который нужно заменить.

    Плюсы:

    * Просто в реализации т.к. почти всё что может понадобиться для создания нового кода находится в скоупе(ссылка на класс, параметры функции и т.д.)

    Минусы:
    * Будет каша
   

2. На этапе матчинга можно оставлять именованные метки
    
    Плюсы:
    * Чище чем способ (1)
    
    Минусы:
    * Теряется информация о типах (хотя возможно как-то можно её сохранить, может быть что-то с `reified` и `as`)

## DSL


### Матчер


```Kotlin
matchFile {
    matchClass {
        // Вместо отдельного блока под всё можно сделать универсальный `match {...}` 
        // с ресивиром. В данном случае `IrClass`
        config {
            // Штуки чтобы вычислить нужный класс по тиму:
            //    это интерфейс? Наследуется от? Типовые параметры? и т.д.
            // Возможно блок конфиг не нужен
            classKind { it == ClassKind.INTERFACE }
            isCompanion()
            isInner()
            isData()
            isExternal()
            isInline()
            isExpect()
            isFun()
            matchSuperTypes { ... }
            matchThisReceiver { ... }
            // и т.д.
        }

        // Проматчить тело класса. Пока не понятно как лучше сделать
        // 1)   Можно утвердить что внутри блока `matchClass` важен порядок и использовать констуркции вида
        //      `matchConstructor` `matchProperty` `matchFunction` `matchCompanion` `anything`
        // 2)   TODO Придумать другой способ
        matchProperty {
            // TODO   
        }
        anything()
        matchFuntion {
            isInline()
            isExternal()
            isExpect()
            matchReturnType { ... }
            matchDispatchReceiverParameter { ... }
            matchExtensionReceiverParameter { ... }
            // TODO
        }
    }
}
```
### Новый код

Скорее всего уже существующий `IrBuilder` отлично справиться с этой задачей.

### Трансформация

